"use strict";var express=require("express"),router=express.Router(),Book=require("../models/Book"),nodemailer=require("nodemailer"),transporter=nodemailer.createTransport({service:"gmail",auth:{user:process.env.EMAIL,pass:process.env.PASSWORD}});router.post("/add",function(r,t){var n,a,s,o,u,c,i,l,p;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.body,a=n.title,s=n.author,o=n.publishedYear,u=n.genre,c=n.availableCopies,i=n.email,e.prev=1,l=new Book({title:a,author:s,publishedYear:o,genre:u,availableCopies:c}),e.next=5,regeneratorRuntime.awrap(l.save());case 5:p={from:process.env.EMAIL,to:i,subject:"Book Added Successfully",text:'The book "'.concat(a,'" has been added to the library.')},transporter.sendMail(p,function(e,r){if(e)return console.log(e);console.log("Email sent: "+r.response)}),t.status(201).json(l),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),t.status(400).json({message:e.t0.message});case 13:case"end":return e.stop()}},null,null,[[1,10]])}),router.get("/",function(e,r){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(Book.find());case 3:t=e.sent,r.json(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),r.status(500).json({message:e.t0.message});case 10:case"end":return e.stop()}},null,null,[[0,7]])}),router.get("/:id",function(r,t){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(Book.findById(r.params.id));case 3:if(null==(n=e.sent))return e.abrupt("return",t.status(404).json({message:"Book not found"}));e.next=6;break;case 6:t.json(n),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),t.status(500).json({message:e.t0.message});case 12:case"end":return e.stop()}},null,null,[[0,9]])}),router.patch("/:id",function(r,t){var n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(Book.findById(r.params.id));case 3:if(null==(n=e.sent))return e.abrupt("return",t.status(404).json({message:"Book not found"}));e.next=6;break;case 6:return null!=r.body.title&&(n.title=r.body.title),null!=r.body.author&&(n.author=r.body.author),null!=r.body.publishedYear&&(n.publishedYear=r.body.publishedYear),null!=r.body.genre&&(n.genre=r.body.genre),null!=r.body.availableCopies&&(n.availableCopies=r.body.availableCopies),e.next=13,regeneratorRuntime.awrap(n.save());case 13:a=e.sent,t.json(a),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),t.status(400).json({message:e.t0.message});case 20:case"end":return e.stop()}},null,null,[[0,17]])}),router.delete("/:id",function(r,t){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(Book.findById(r.params.id));case 3:if(null==(n=e.sent))return e.abrupt("return",t.status(404).json({message:"Book not found"}));e.next=6;break;case 6:return e.next=8,regeneratorRuntime.awrap(n.remove());case 8:t.json({message:"Book deleted"}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),t.status(500).json({message:e.t0.message});case 14:case"end":return e.stop()}},null,null,[[0,11]])}),module.exports=router;
//# sourceMappingURL=books.min.js.map
